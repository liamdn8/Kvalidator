apiVersion: v1
data:
  elasticsearch.yml: |
    cluster.name: es-hla
    network.host: ["_bond0.1005_", "_bond1.1006_"]
    http.host: "_bond0.1005_"
    http.publish_host: "_bond0.1005_"
    transport.host: "_bond1.1006_"
    transport.publish_host: "_bond1.1006_"
    http.port: 9200
    transport.port: 9300

    xpack.security.enabled: true
    xpack.security.transport.ssl.enabled: true
    xpack.security.transport.ssl.verification_mode: certificate
    xpack.security.transport.ssl.key: certs/tls.key
    xpack.security.transport.ssl.certificate: certs/tls.crt
    xpack.security.transport.ssl.certificate_authorities: [ "certs/ca.crt" ]
    xpack.security.http.ssl.enabled: true
    xpack.security.http.ssl.key: certs/tls.key
    xpack.security.http.ssl.certificate: certs/tls.crt
    xpack.security.http.ssl.certificate_authorities: [ "certs/ca.crt" ]
    path.logs: /usr/share/elasticsearch/logs
    node.name: ${NODE_NAME}
    node.roles: ${NODE_ROLES}

    thread_pool:
      write:
        size: 32
        queue_size: 30000
      search:
        size: 32
        queue_size: 10000

    indices.memory.index_buffer_size: 35%

    # Recovery tuning
    indices.recovery.max_bytes_per_sec: 8gb
    indices.recovery.max_concurrent_operations: 4
    cluster.routing.allocation.node_concurrent_recoveries: 8
    cluster.routing.allocation.node_initial_primaries_recoveries: 8
    cluster.routing.allocation.cluster_concurrent_rebalance: 8
    indices.recovery.recovery_activity_timeout: 30m
    indices.recovery.internal_action_timeout: 2m
    indices.recovery.max_concurrent_file_chunks: 4

    # Routing
    cluster.routing.allocation.enable: all
    cluster.routing.allocation.balance.shard: 0.45
    cluster.routing.allocation.balance.index: 0.55
    cluster.routing.allocation.allow_rebalance: always

    discovery.seed_hosts: ["172.21.114.8", "172.21.114.17", "172.21.114.36", "172.21.114.45", "172.21.114.54"]
    cluster.initial_master_nodes: ["hlavtn01compocs4log01", "hlavtn01compocs4log10", "hlavtn01compocs4log19", "hlavtn01compocs4log28", "hlavtn01compocs4log37"]
kind: ConfigMap
metadata:
  name: elasticsearch-config
  namespace: elk
